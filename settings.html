<!DOCTYPE html>
<html lang="ps" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯ Ø³ÛŒØ³Ù¼Ù… ØªØ±ØªÛŒØ¨Ø§Øª - Ø¨Ø§Ø¨Ø§ Ù‡ÙˆØªÚ© Ù„ÛŒØ³Ù‡</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #f0f2f5; margin: 0; padding: 15px; direction: rtl; }
        .settings-container { max-width: 600px; margin: auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 2px solid #f0f2f5; padding-bottom: 15px; }
        .back-btn { text-decoration: none; color: #3498db; font-weight: bold; font-size: 14px; }
        
        .setting-group { margin-bottom: 20px; }
        .setting-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #2c3e50; font-size: 14px; }
        .setting-group input, .setting-group select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-family: inherit; box-sizing: border-box; }
        
        .save-btn { width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .save-btn:hover { background: #219150; }
        
        .danger-zone { margin-top: 40px; padding: 20px; border: 1px dashed #e74c3c; border-radius: 15px; background: #fff5f5; }
        .danger-zone h4 { color: #e74c3c; margin-top: 0; }
        .reset-btn { background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="settings-container">
    <div class="header">
        <h2 style="margin:0;">âš™ï¸ Ø¯ Ø³ÛŒØ³Ù¼Ù… ØªØ±ØªÛŒØ¨Ø§Øª</h2>
        <a href="admin_dashboard.html" class="back-btn">â¬…ï¸ Ø´Ø§ØªÙ‡</a>
    </div>

    <div class="setting-group">
        <label>Ø¯ ÚšÙˆÙˆÙ†ÚÙŠ Ù†ÙˆÙ…:</label>
        <input type="text" id="schoolName" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø§Ø¨Ø§ Ù‡ÙˆØªÚ© Ù„ÛŒØ³Ù‡">
    </div>

    <div class="setting-group">
        <label>Ø¯ Ù…Ø¯ÛŒØ± Ù†ÙˆÙ…:</label>
        <input type="text" id="adminName" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø±Ø­Ù…Øª Ø§Ù„Ù„Ù‡ Ø¹Ù„Ù…ÙŠ">
    </div>

    <div class="setting-group">
        <label>Ø¯ Ø±Ø®ØµØªÛ ÙˆØ±Ú:</label>
        <select id="offDay">
            <option value="Ø¬Ù…Ø¹Ù‡">Ø¬Ù…Ø¹Ù‡</option>
            <option value="Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡">Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡</option>
        </select>
    </div>

    <div class="setting-group">
        <label>Ø¯ Ø­Ø§Ø¶Ø±ÙŠ ÙˆØ®Øª (Ù†Ø§ÙˆØ®ØªÙ‡ Ú©ÛØ¯Ù„ - Ø¯Ù‚ÛŒÙ‚Ù‡):</label>
        <input type="number" id="lateLimit" value="15">
    </div>

    <button class="save-btn" onclick="saveSettings()">ğŸ’¾ ØªØºÛŒØ±Ø§Øª Ø®ÙˆÙ†Ø¯ÙŠ Ú©Ú“Ù‡</button>

    <div class="danger-zone">
        <h4>Ø®Ø·Ø±Ù†Ø§Ú©Ù‡ Ø³ÛŒÙ…Ù‡!</h4>
        <p style="font-size: 12px; color: #666;">Ù¾Ø§Ù… Ú©ÙˆØ¦ØŒ Ø¯ Ú‰ÛŒÙ¼Ø§ Ù¾Ø§Ú©ÙˆÙ„ Ø¨ÛØ±ØªÙ‡ Ù†Ù‡Ú«Ø±ÚÙŠ.</p>
        <button class="reset-btn" onclick="clearLocalData()">Ø¯ Ø¨Ø±Ø§ÙˆØ²Ø± Ø­Ø§ÙØ¸Ù‡ Ù¾Ø§Ú©Ù‡ Ú©Ú“Ù‡</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

<script>
    // ÙØ§ÛŒØ±Ø¨ÛŒØ³ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
    const firebaseConfig = {
        apiKey: "AIzaSyB1SSjuFWV0Fjnpm6bjbK-6r-5qNdZPQsM",
        authDomain: "babahotakschool.firebaseapp.com",
        projectId: "babahotakschool",
        storageBucket: "babahotakschool.firebasestorage.app",
        messagingSenderId: "12958892996",
        appId: "1:12958892996:web:477e44b4453a0fbd9b9a91"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Ø¯ ØªØ±ØªÛŒØ¨Ø§ØªÙˆ Ø±Ø§ÙˆÚ“Ù„
    async function loadSettings() {
        const doc = await db.collection("schoolSettings").doc("general").get();
        if (doc.exists) {
            const data = doc.data();
            document.getElementById('schoolName').value = data.schoolName || "";
            document.getElementById('adminName').value = data.adminName || "";
            document.getElementById('offDay').value = data.offDay || "Ø¬Ù…Ø¹Ù‡";
            document.getElementById('lateLimit').value = data.lateLimit || 15;
        }
    }

    // Ø¯ ØªØ±ØªÛŒØ¨Ø§ØªÙˆ Ø®ÙˆÙ†Ø¯ÙŠ Ú©ÙˆÙ„
    async function saveSettings() {
        const sName = document.getElementById('schoolName').value;
        const aName = document.getElementById('adminName').value;
        const oDay = document.getElementById('offDay').value;
        const lLimit = document.getElementById('lateLimit').value;

        try {
            await db.collection("schoolSettings").doc("general").set({
                schoolName: sName,
                adminName: aName,
                offDay: oDay,
                lateLimit: lLimit,
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
            });
            alert("âœ… ØªØ±ØªÛŒØ¨Ø§Øª Ù¾Ù‡ Ø¨Ø±ÛŒØ§Ù„ÛŒØªÙˆØ¨ Ø³Ø±Ù‡ Ø§Ù¾Ú‰ÛÙ¼ Ø´ÙˆÙ„!");
        } catch (e) {
            alert("ØªÛØ±ÙˆØªÙ†Ù‡: " + e.message);
        }
    }

    function clearLocalData() {
        if(confirm("Ø§ÛŒØ§ Ú‰Ø§Ú‰Ù‡ ÛŒØ§Ø³Øª Ú†Û ØºÙˆØ§Ú“Ø¦ Ø¯ Ø¨Ø±Ø§ÙˆØ²Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø§Ùˆ Ù„Ø§Ú« Ø§Ù† Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù¾Ø§Ú© Ú©Ú“Ø¦ØŸ")) {
            localStorage.clear();
            window.location.href = 'login.html';
        }
    }

    window.onload = loadSettings;
</script>
</body>
</html>
