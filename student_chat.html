<!DOCTYPE html>
<html lang="ps" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¼ÙˆÙ„Ú«ÛŒØ² Ú†Ù¼ - Ø¨Ø§Ø¨Ø§ Ù‡ÙˆØªÚ© Ù„ÛŒØ³Ù‡</title>
    <style>
        :root { --primary: #27ae60; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 0; direction: rtl; }
        
        .chat-container { display: flex; flex-direction: column; height: 100vh; max-width: 500px; margin: auto; background: white; }
        
        .chat-header { background: var(--primary); color: white; padding: 15px; text-align: center; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        
        .messages-area { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; background: #e5ddd5; }
        
        /* Ø¯ Ù¾ÛŒØºØ§Ù…ÙˆÙ†Ùˆ Ø³Ù¼Ø§ÛŒÙ„ */
        .msg { max-width: 80%; padding: 10px; border-radius: 15px; font-size: 14px; position: relative; line-height: 1.5; }
        .msg-me { align-self: flex-start; background: #dcf8c6; border-bottom-right-radius: 2px; }
        .msg-others { align-self: flex-end; background: white; border-bottom-left-radius: 2px; }
        
        .sender-name { font-size: 10px; font-weight: bold; color: #27ae60; display: block; margin-bottom: 3px; }
        .msg-time { font-size: 9px; color: #999; display: block; text-align: left; margin-top: 5px; }

        .input-area { padding: 10px; background: white; display: flex; gap: 10px; border-top: 1px solid #ddd; }
        input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 25px; outline: none; }
        button { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="chat-container">
    <div class="chat-header">
        <a href="student_dashboard.html" style="color:white; text-decoration:none;">â¬…ï¸</a>
        <span>Ù¼ÙˆÙ„Ú«ÛŒØ² Ú«Ø±ÙˆÙ¾ (Ù†Ù‡Ù… Ø§Ù„Ù)</span>
        <span>ğŸ‘¥</span>
    </div>

    <div class="messages-area" id="chatBox">
        </div>

    <div class="input-area">
        <input type="text" id="msgInput" placeholder="Ù¾ÛŒØºØ§Ù… ÙˆÙ„ÛŒÚ©Ø¦...">
        <button onclick="sendMessage()">Ù„ÛÚ–Ù„</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>

<script>
    // Ø³ØªØ§ Ø¯ ÙØ§ÛŒØ±Ø¨ÛŒØ³ ØªØ±ØªÛŒØ¨ (Ù„Ú©Ù‡ Ù¾Ø®ÙˆØ§)
    const firebaseConfig = {
        apiKey: "AIzaSyB1SSjuFWV0Fjnpm6bjbK-6r-5qNdZPQsM",
        authDomain: "babahotakschool.firebaseapp.com",
        projectId: "babahotakschool",
        storageBucket: "babahotakschool.firebasestorage.app",
        messagingSenderId: "12958892996",
        appId: "1:12958892996:web:477e44b4453a0fbd9b9a91"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const userName = localStorage.getItem('userName') || "Ù†Ø§Ù¾ÛŒÚ˜Ø§Ù†Ø¯Ù‡ Ø´Ø§Ú«Ø±Ø¯";
    const chatBox = document.getElementById('chatBox');

    // Ø¯ Ù¾ÛŒØºØ§Ù…ÙˆÙ†Ùˆ Ø±Ø§ÙˆÚ“Ù„ Ù¾Ù‡ Ú˜ÙˆÙ†Ø¯Û Ø¨Ú¼Ù‡ (Real-time)
    db.collection("classMessages").orderBy("time", "asc")
    .onSnapshot((snapshot) => {
        chatBox.innerHTML = "";
        snapshot.forEach((doc) => {
            const data = doc.data();
            const isMe = data.sender === userName;
            
            const msgDiv = document.createElement('div');
            msgDiv.className = `msg ${isMe ? 'msg-me' : 'msg-others'}`;
            msgDiv.innerHTML = `
                <span class="sender-name">${data.sender}</span>
                ${data.text}
                <span class="msg-time">${new Date(data.time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
            `;
            chatBox.appendChild(msgDiv);
        });
        chatBox.scrollTop = chatBox.scrollHeight;
    });

    async function sendMessage() {
        const text = document.getElementById('msgInput').value.trim();
        if(!text) return;

        await db.collection("classMessages").add({
            sender: userName,
            text: text,
            time: Date.now()
        });
        document.getElementById('msgInput').value = "";
    }
</script>

</body>
</html>
