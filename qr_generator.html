<!DOCTYPE html>
<html lang="ps" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¯ Ú©Ø§Ø±ØªÙˆÙ†Ùˆ Ú†Ø§Ù¾ - Ø¨Ø§Ø¨Ø§ Ù‡ÙˆØªÚ© Ù†Ù…Ø¨Ø± Û²</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        :root { --main-blue: #004d99; --text-black: #000; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; direction: rtl; }

        /* Ø¯ Ú†Ø§Ù¾ ØªÙ†Ø¸ÛŒÙ…Ø§Øª */
        @media print {
            .no-print { display: none !important; }
            body { background: white; padding: 0; margin: 0; }
            #cardsContainer { 
                display: grid; 
                grid-template-columns: 1fr 1fr; 
                gap: 5mm; 
                padding: 10mm; 
            }
            .card-wrapper { page-break-inside: avoid; margin-bottom: 10mm; border: none; }
        }

        #cardsContainer { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }

        /* Ù„ÙˆÙ…Ú“ÛŒ Ù…Ø® */
        .id-card-front {
            width: 85.6mm; height: 53.98mm; background: white; border: 1.5px solid #333;
            border-radius: 8px; position: relative; overflow: hidden;
        }
        .header { background: var(--main-blue); color: white; padding: 8px; text-align: center; border-bottom: 2px solid #d4af37; }
        .header h2 { margin: 0; font-size: 13px; font-weight: bold; }
        
        .main-content { display: flex; padding: 10px; gap: 10px; height: calc(100% - 50px); }
        .photo-frame { width: 75px; height: 90px; border: 2px solid var(--main-blue); border-radius: 4px; object-fit: cover; }
        
        .info-area { flex: 1; font-size: 12px; line-height: 1.5; color: var(--text-black); }
        .info-row { display: flex; border-bottom: 0.5px solid #eee; margin-bottom: 3px; }
        .info-label { font-weight: bold; width: 70px; color: var(--main-blue); }

        /* Ø´Ø§ØªÙ†ÛŒ Ù…Ø® */
        .id-card-back {
            width: 85.6mm; height: 53.98mm; background: #fdfdfd; border: 1.5px solid #333;
            border-radius: 8px; padding: 10px; position: relative;
        }
        .rules-title { font-weight: bold; font-size: 11px; margin-bottom: 5px; color: var(--main-blue); border-bottom: 1px solid #ddd; }
        .rules-text { font-size: 9.5px; text-align: justify; line-height: 1.4; margin: 0; }
        .footer-info { position: absolute; bottom: 8px; right: 10px; font-size: 8.5px; line-height: 1.3; }
        .qr-pos { position: absolute; bottom: 8px; left: 8px; background: white; padding: 2px; border: 1px solid #ddd; }
    </style>
</head>
<body>

<div class="no-print" style="margin-bottom: 30px; text-align: center;">
    <button onclick="window.print()" style="padding: 15px 40px; background: #27ae60; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">ğŸ–¨ï¸ Ø¯ Ú©Ø§Ø±ØªÙˆÙ†Ùˆ Ú†Ø§Ù¾ÙˆÙ„ (A4 Ú©Ø§ØºØ°)</button>
</div>

<div id="cardsContainer"></div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyB1SSjuFWV0Fjnpm6bjbK-6r-5qNdZPQsM",
    authDomain: "babahotakschool.firebaseapp.com",
    projectId: "babahotakschool",
    storageBucket: "babahotakschool.firebasestorage.app",
    appId: "1:12958892996:web:477e44b4453a0fbd9b9a91"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

function loadCards() {
    const container = document.getElementById('cardsContainer');
    db.collection("babaStudents").onSnapshot(snapshot => {
        container.innerHTML = "";
        snapshot.forEach(doc => {
            const data = doc.data();
            const asas = data.asas || "---"; 
            const name = data.name || "---"; 
            const father = data.father || "---"; 
            const grade = data.grade || "---"; 

            const cardHTML = `
            <div class="card-wrapper" style="display: flex; gap: 15px;">
                <div class="id-card-front">
                    <div class="header">
                        <h2>Ø¨Ø§Ø¨Ø§ Ù‡ÙˆØªÚ© Ø¯ÙˆÛŒÙ… Ù†Ù…Ø¨Ø± Ø¹Ø§Ù„ÙŠ Ù„ÛŒØ³Ù‡</h2>
                    </div>
                    <div class="main-content">
                        <img src="${data.photoUrl || 'student.png'}" class="photo-frame" onerror="this.src='https://via.placeholder.com/75x90'">
                        <div class="info-area">
                            <div class="info-row"><span class="info-label">Ù†ÙˆÙ…:</span><span>${name}</span></div>
                            <div class="info-row"><span class="info-label">Ù¾Ù„Ø§Ø± Ù†ÙˆÙ…:</span><span>${father}</span></div>
                            <div class="info-row"><span class="info-label">Ù¼ÙˆÙ„Ú«ÛŒ:</span><span>${grade}</span></div>
                            <div class="info-row"><span class="info-label">Ø§Ø³Ø§Ø³ Ù†Ù…Ø¨Ø±:</span><span style="font-weight:bold;">${asas}</span></div>
                            <div class="info-row"><span class="info-label">ÙˆÛŒÙ†Ù‡:</span><span>${data.bloodType || '+A'}</span></div>
                        </div>
                    </div>
                </div>

                <div class="id-card-back">
                    <div class="rules-title">Ù‚ÙˆØ§Ù†ÛŒÙ† Ø§Ùˆ Ù„Ø§Ø±ÚšÙˆÙˆÙ†Û:</div>
                    <p class="rules-text">
                        Ø¯Ø§ Ú©Ø§Ø±Øª Ø¯ ÚšÙˆÙˆÙ†ÚÙŠ Ø±Ø³Ù…ÙŠ Ù…Ù„Ú©ÛŒØª Ø¯ÛŒ. Ø¯ ÙˆØ±Ú©ÛØ¯Ùˆ Ù¾Ù‡ ØµÙˆØ±Øª Ú©Û Ú˜Ø± ØªØ± Ú˜Ø±Ù‡ Ø§Ø¯Ø§Ø±Û ØªÙ‡ Ø®Ø¨Ø± ÙˆØ±Ú©Ú“Ø¦. 
                        Ø¯Ø§ Ú©Ø§Ø±Øª ÛŒÙˆØ§Ø²Û Ø¯ Ø±ÙˆØ§Ù† ØªØ¹Ù„ÛŒÙ…ÙŠ Ú©Ø§Ù„ Ù„Ù¾Ø§Ø±Ù‡ Ø¨Ø§ÙˆØ±ÙŠ Ø¯ÛŒ. Ø¯ Ú©Ø§Ø±Øª Ù„Ù‡ Ø¨ÛŒØ§ Ø¬ÙˆÚ“ÙˆÙ„Ùˆ Ú…Ø®Ù‡ Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø¬Ø±Ù… Ø¯ÛŒ.
                    </p>
                    <div class="footer-info">
                        <strong>Ù¾ØªÙ‡:</strong> Ø²Ø§Ø¨Ù„ØŒ Ø´Ø§Ù‡ Ø¬ÙˆÛŒ Ø¨Ø§Ø²Ø§Ø± <br>
                        <strong>Ø§Ú“ÛŒÚ©Ù‡:</strong> 0700777746 <br>
                        <strong>Ø§ÛŒÙ…ÛŒÙ„:</strong> rahmatalmi145@gmail.com
                    </div>
                    <div class="qr-pos" id="qr-${doc.id}"></div>
                </div>
            </div>`;
            container.innerHTML += cardHTML;

            setTimeout(() => {
                new QRCode(document.getElementById(`qr-${doc.id}`), { text: asas.toString(), width: 45, height: 45 });
            }, 300);
        });
    });
}
window.onload = loadCards;
</script>
</body>
</html>
